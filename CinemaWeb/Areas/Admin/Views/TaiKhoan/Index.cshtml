@model CinemaWeb.Areas.Admin.Models.TaiKhoanModel

@{
    ViewData["Title"] = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<h1>Index</h1>

<p>
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#AddModal">Thêm</button>
</p>
<div class="modal carousel-fade" id="AddModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Thêm Tai Khoan</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form asp-action="Create">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <div class="form-group">
                        <label asp-for="Username" class="control-label"></label>
                        <input asp-for="Username" id="username" class="form-control" />
                        <span asp-validation-for="Username" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="Password" class="control-label"></label>
                        <input asp-for="Password" id="password" class="form-control" />
                        <span asp-validation-for="Password" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="HoTen" class="control-label"></label>
                        <input asp-for="HoTen" id="hoten" class="form-control" />
                        <span asp-validation-for="HoTen" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="SDT" class="control-label"></label>
                        <input asp-for="SDT" id="sdt" class="form-control" />
                        <span asp-validation-for="SDT" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="LoaiTK" class="control-label"></label>
                        <input asp-for="LoaiTK" id="loaitk" class="form-control" />
                        <span asp-validation-for="LoaiTK" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="TrangThai" class="control-label"></label>
                        <input asp-for="TrangThai" id="trangthai" class="form-control" />
                        <span asp-validation-for="TrangThai" class="text-danger"></span>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                <button type="button" name="btn_create_taikhoan" class="btn btn-primary">Thêm Mới</button>
            </div>
        </div>
    </div>
</div>

<div class="modal carousel-fade" id="EditModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Sua Tai Khoan</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <input type="hidden" asp-for="Username" id="edit_username" />
                    <div class="form-group">
                        <label asp-for="Password" class="control-label"></label>
                        <input asp-for="Password" id="edit_password" class="form-control" />
                        <span class="text-danger">@Html.ValidationMessageFor(model => model.Password)</span>
                    </div>
                    <div class="form-group">
                        <label asp-for="HoTen" class="control-label"></label>
                        <input asp-for="HoTen" id="edit_hoten" class="form-control" />
                        <span class="text-danger">@Html.ValidationMessageFor(model => model.HoTen)</span>
                    </div>
                    <div class="form-group">
                        <label asp-for="SDT" class="control-label"></label>
                        <input asp-for="SDT" id="edit_sdt" class="form-control" />
                        <span class="text-danger">@Html.ValidationMessageFor(model => model.SDT)</span>
                    </div>
                    <div class="form-group">
                        <label asp-for="LoaiTK" class="control-label"></label>
                        <input asp-for="LoaiTK" id="edit_loaitk" class="form-control" />
                        <span class="text-danger">@Html.ValidationMessageFor(model => model.LoaiTK)</span>
                    </div>
                    <div class="form-group">
                        <label asp-for="TrangThai" class="control-label"></label>
                        <input type="checkbox" asp-for="TrangThai" id="edit_trangthai" class="form-control" />
                        <span class="text-danger">@Html.ValidationMessageFor(model => model.TrangThai)</span>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                <button type="button" name="btn_update_taikhoan" class="btn btn-primary">Cập Nhật</button>
            </div>
        </div>
    </div>
</div>
<table class="table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Username)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Password)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.HoTen)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.SDT)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.LoaiTK)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.TrangThai)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in ViewBag.DsTaiKhoan)
        {
            <tr>
                <td>
                    @item.Username
                </td>
                <td>
                    @item.Password
                </td>
                <td>
                    @item.HoTen
                </td>
                <td>
                    @item.SDT
                </td>
                <td>
                    @item.LoaiTK
                </td>
                <td>
                    @item.TrangThai
                </td>
                <td>
                    @*<a asp-action="Edit" asp-route-id="@item.Username">Edit</a> |*@
                    <button type="button" name="edit_taikhoan" data-idtaikhoan="@item.Username" class="btn btn-primary" data-toggle="modal" data-target="#EditModal">Edit</button>
                    <a asp-action="Details" class="btn btn-primary" asp-route-id="@item.Username">Details</a> |
                    @*<a asp-action="Delete" asp-route-id="@item.Username">Delete</a>*@
                    <button type="button" name="btn_delete_taikhoan" data-idtaikhoan="@item.Username" class="btn btn-danger">Delete</button>
                </td>
            </tr>
        }
    </tbody>
</table>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>

        function addTaiKhoan() {
            var insert = {};
            insert.Username = $("#username").val();
            insert.Password = $("#password").val();
            insert.HoTen = $("#hoten").val();
            insert.SDT = $("#sdt").val();
            insert.LoaiTK = $("#loaitk").val();
            insert.TrangThai = Boolean($("#trangthai").val());
            $.ajax({
                url: "../../api/TaiKhoanApi/PostTaiKhoanModel",
                type: "POST",
                contentType: "Application/json;charset-utf-8",
                data: JSON.stringify(insert),
                dataType: "json"
            }).done(function (reponse) {
                alert('Thêm vào tài khoản thành công!');
                location.reload();
            }).fail(function () {
                alert('Thất bại !');
            });
        }
        $(document).ready(function () {
            $('button[name=btn_create_taikhoan]').click(function (e) {
                addTaiKhoan();
                e.preventDefault();
            });
        });

        function getTaiKhoan(Username) {
            $.ajax({
                url: "../../api/TaiKhoanApi/GetTaiKhoanModel/" + Username,
                type: "GET",
                contentType: "Application/json;charset-utf-8",
                dataType: "json"
            }).done(function (reponse) {
                console.log(reponse);
                $("#edit_username").val(reponse.username);
                $("#edit_password").val(reponse.password);
                $("#edit_hoten").val(reponse.hoTen);
                $("#edit_sdt").val(reponse.sdt);
                $("#edit_loaitk").val(reponse.loaiTK);
                if (reponse.trangThai == true) {
                    $("#edit_trangthai").prop("checked", true);
                } else $("#edit_trangthai").prop("checked", false);



            }).fail(function () {
                alert('Thất bại !');
            });
        }

        function updateTaiKhoan(Username) {
            var update = {}
            update.Username = Username;
            update.Password = $("#edit_password").val();
            update.HoTen = $("#edit_hoten").val();
            update.SDT = $("#edit_sdt").val();
            update.LoaiTK = $("#edit_loaitk").val();
            update.TrangThai = Boolean($("#edit_trangthai").val());
            $.ajax({
                url: "../../api/TaiKhoanApi/PutTaiKhoanModel/" + Username,
                type: "PUT",
                contentType: "Application/json;charset-utf-8",
                data: JSON.stringify(update),
                dataType: "json"
            }).done(function (reponse) {
                alert('Update khoản thành công!');
                location.reload();


            }).fail(function () {
                alert('Thất bại !');
            });
        }
        function deleteTaiKhoan(Username) {

            $.ajax({
                url: "../../api/TaiKhoanApi/DeleteTaiKhoanModel/" + Username,
                type: "DELETE",
                contentType: "Application/json;charset-utf-8",
                dataType: "json"
            }).done(function (reponse) {
                alert('Xóa khoản thành công!');
                location.reload();
            }).fail(function () {
                alert('Thất bại !');
            });

        }
        $('button[name=edit_taikhoan]').click(function (e) {
            var Username = $(this).data("idtaikhoan");
            getTaiKhoan(Username);
            e.preventDefault();
        });
        $('button[name=btn_update_taikhoan]').click(function (e) {
            var Username = $("#edit_username").val();
            updateTaiKhoan(Username);
            e.preventDefault();
        });

        $('button[name=btn_delete_taikhoan]').click(function (e) {
            var Username = $(this).data("idtaikhoan");
            deleteTaiKhoan(Username);
            e.preventDefault();
        });
    </script>
}